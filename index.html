<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur de Risque Boursier</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); min-height: 100vh; padding: 20px; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(to right, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { color: #94a3b8; }
        .search-box { background: #1e293b; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .search-form { display: flex; gap: 15px; margin-bottom: 20px; }
        .search-form input { flex: 1; padding: 15px 20px; background: #0f172a; border: 2px solid #334155; border-radius: 10px; color: #fff; font-size: 16px; }
        .search-form input:focus { outline: none; border-color: #3b82f6; }
        .search-form button { padding: 15px 40px; background: #3b82f6; border: none; border-radius: 10px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
        .search-form button:hover { background: #2563eb; }
        .search-form button:disabled { opacity: 0.5; cursor: not-allowed; }
        .api-setup { background: #fef3c7; color: #92400e; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .api-setup h3 { margin-bottom: 10px; }
        .api-setup ol { margin-left: 20px; margin-top: 10px; }
        .api-setup li { margin: 8px 0; }
        .api-setup a { color: #2563eb; font-weight: 600; }
        .api-input-group { display: flex; gap: 10px; margin-top: 15px; }
        .api-input-group input { flex: 1; padding: 10px; border: 2px solid #d97706; border-radius: 8px; font-family: monospace; }
        .api-input-group button { padding: 10px 20px; background: #059669; border: none; border-radius: 8px; color: #fff; font-weight: 600; cursor: pointer; }
        .error { background: #ef4444; color: #fff; padding: 15px 20px; border-radius: 10px; margin-top: 15px; display: none; }
        .error.show { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #1e293b; border-radius: 16px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .stat-label { color: #94a3b8; font-size: 14px; margin-bottom: 8px; }
        .stat-value { font-size: 36px; font-weight: 700; margin-bottom: 10px; }
        .risk-bar { height: 8px; background: #0f172a; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .risk-bar-fill { height: 100%; transition: width 1s ease; }
        .chart-container { background: #1e293b; border-radius: 16px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .chart-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .methodology { background: #1e293b; border-radius: 16px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .methodology h3 { margin-bottom: 15px; }
        .methodology ul { margin-left: 20px; color: #cbd5e1; }
        .methodology li { margin: 8px 0; }
        #results { display: none; }
        #results.show { display: block; }
        .quick-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .quick-btn { padding: 8px 16px; background: #334155; border: none; border-radius: 8px; color: #cbd5e1; cursor: pointer; font-size: 14px; }
        .quick-btn:hover { background: #475569; color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Analyseur de Risque Boursier</h1>
            <p>Inspir√© de la m√©trique de risque crypto de Ben Cowen</p>
        </div>
        <div class="search-box">
            <div class="api-setup" id="apiSetup">
                <h3>‚öôÔ∏è Configuration requise (une seule fois)</h3>
                <ol>
                    <li>Obtenez votre cl√© API gratuite : <a href="https://finnhub.io/register" target="_blank">finnhub.io/register</a></li>
                    <li>Cr√©ez un compte gratuit (30 secondes)</li>
                    <li>Copiez votre cl√© API depuis le dashboard</li>
                </ol>
                <div class="api-input-group">
                    <input type="text" id="apiKeyInput" placeholder="Collez votre cl√© API Finnhub ici...">
                    <button onclick="saveApiKey()">üíæ Sauvegarder</button>
                </div>
                <p style="margin-top: 10px; font-size: 12px;">‚ÑπÔ∏è Limite gratuite : 60 requ√™tes/minute</p>
            </div>
            <form class="search-form" onsubmit="analyzeStock(event)">
                <input type="text" id="tickerInput" placeholder="Entrez le symbole (ex: AAPL, MSFT, TSLA...)" required>
                <button type="submit" id="analyzeBtn">üîç Analyser</button>
            </form>
            <div class="quick-buttons">
                <span style="color: #94a3b8; margin-right: 10px;">Exemples:</span>
                <button class="quick-btn" onclick="quickAnalyze('AAPL')">AAPL</button>
                <button class="quick-btn" onclick="quickAnalyze('MSFT')">MSFT</button>
                <button class="quick-btn" onclick="quickAnalyze('GOOGL')">GOOGL</button>
                <button class="quick-btn" onclick="quickAnalyze('TSLA')">TSLA</button>
                <button class="quick-btn" onclick="quickAnalyze('NVDA')">NVDA</button>
            </div>
            <div class="error" id="errorMsg"></div>
        </div>
        <div id="results">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Action</div>
                    <div class="stat-value" id="tickerDisplay">-</div>
                    <div style="color: #60a5fa; font-size: 24px;" id="priceDisplay">$0.00</div>
                    <div style="color: #cbd5e1; font-size: 14px;" id="companyName">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Risk Metric</div>
                    <div class="stat-value" id="riskDisplay" style="color: #22c55e;">0.000</div>
                    <div class="risk-bar"><div class="risk-bar-fill" id="riskBar" style="width: 0%;"></div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Recommandation</div>
                    <div style="font-size: 14px; font-weight: 600; margin-top: 10px;" id="recommendation">-</div>
                    <div style="font-size: 32px; margin-top: 10px;" id="trendIcon">üìä</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">P/E Ratio</div>
                    <div class="stat-value" style="font-size: 28px;" id="peRatio">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Prix cible analystes</div>
                    <div class="stat-value" style="font-size: 28px; color: #60a5fa;" id="targetPrice">-</div>
                    <div style="font-size: 14px;" id="priceUpside">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Croissance revenus</div>
                    <div class="stat-value" style="font-size: 28px;" id="ebitdaGrowth">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Recommandation Analystes</div>
                    <div style="font-size: 20px; font-weight: 600; margin-top: 10px;" id="analystRating">-</div>
                    <div style="font-size: 14px; color: #94a3b8;" id="analystCount">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">EPS</div>
                    <div class="stat-value" style="font-size: 28px;" id="eps">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Marge b√©n√©ficiaire</div>
                    <div class="stat-value" style="font-size: 28px;" id="profitMargin">-</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Prix et Moyennes Mobiles</div>
                <canvas id="priceChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">√âvolution du Risk Metric</div>
                <canvas id="riskChart"></canvas>
            </div>
            <div class="methodology">
                <h3>üìñ M√©thodologie</h3>
                <ul>
                    <li><strong>Position vs MA (35%)</strong> : Distance par rapport aux MA50 et MA200</li>
                    <li><strong>RSI (35%)</strong> : D√©tecte les zones de surachat/survente</li>
                    <li><strong>Volatilit√© (30%)</strong> : Instabilit√© des prix sur 30 jours</li>
                </ul>
            </div>
        </div>
    </div>
    <script>
var priceChart,riskChart,apiKey=localStorage.getItem('finnhubKey')||'',CORS_PROXY='https://api.allorigins.win/raw?url=';apiKey&&(document.getElementById('apiSetup').style.display='none',document.getElementById('apiKeyInput').value=apiKey);function saveApiKey(){var a=document.getElementById('apiKeyInput').value.trim();a?(localStorage.setItem('finnhubKey',a),apiKey=a,document.getElementById('apiSetup').style.display='none',showError('\u2705 Cl\u00e9 API sauvegard\u00e9e !','success')):showError('\u26a0\ufe0f Veuillez entrer une cl\u00e9 API valide')}function quickAnalyze(a){document.getElementById('tickerInput').value=a,analyzeStock(new Event('submit'))}async function analyzeStock(a){if(a.preventDefault(),!apiKey){showError('\u26a0\ufe0f Veuillez configurer votre cl\u00e9 API Finnhub');return}const b=document.getElementById('tickerInput').value.toUpperCase().trim(),c=document.getElementById('analyzeBtn');c.disabled=!0,c.textContent='\u231b Analyse...',hideError();try{const d=await fetchStockData(b),e=calculateRiskMetric(d);c.textContent='\u231b Donn\u00e9es fondamentales...';const f=await fetchFundamentals(b);displayResults(b,e,f)}catch(a){showError('\u274c '+a.message)}finally{c.disabled=!1,c.textContent='\uD83D\uDD0D Analyser'}}async function fetchStockData(a){try{const b=Math.floor(Date.now()/1e3),c=b-31536e3,d='https://finnhub.io/api/v1/stock/candle?symbol='+a+'&resolution=D&from='+c+'&to='+b+'&token='+apiKey,e=CORS_PROXY+encodeURIComponent(d),f=await fetch(e),g=await f.json();if('no_data'===g.s||!g.c||0===g.c.length)throw Error('Symbole "'+a+'" invalide ou aucune donn\u00e9e disponible');if('error'===g.s)throw Error('Erreur API Finnhub');const h=g.t.map(function(a,b){return{date:new Date(1e3*a).toISOString().split('T')[0],price:parseFloat(g.c[b].toFixed(2))}});if(50>h.length)throw Error('Donn\u00e9es insuffisantes (minimum 50 jours)');return h}catch(a){throw console.error('Erreur r\u00e9cup\u00e9ration prix:',a),a}}async function fetchFundamentals(a){try{const b='https://finnhub.io/api/v1/stock/profile2?symbol='+a+'&token='+apiKey,c=CORS_PROXY+encodeURIComponent(b),d=await fetch(c),e=await d.json(),f='https://finnhub.io/api/v1/stock/metric?symbol='+a+'&metric=all&token='+apiKey,g=CORS_PROXY+encodeURIComponent(f),h=await fetch(g),i=await h.json(),j='https://finnhub.io/api/v1/stock/recommendation?symbol='+a+'&token='+apiKey,k=CORS_PROXY+encodeURIComponent(j),l=await fetch(k),m=await l.json(),n='https://finnhub.io/api/v1/stock/price-target?symbol='+a+'&token='+apiKey,o=CORS_PROXY+encodeURIComponent(n),p=await fetch(o),q=await p.json();if(!e||!e.name)throw Error('Donn\u00e9es fondamentales non disponibles');const r=i.metric||{},s=m&&0<m.length?m[0]:null;return{name:e.name||'N/A',peRatio:r.peBasicExclExtraTTM||r.peNormalizedAnnual||'N/A',eps:r.epsBasicExclExtraItemsTTM||r.epsTTM||'N/A',profitMargin:r.netProfitMarginTTM?(100*r.netProfitMarginTTM).toFixed(2)+'%':r.netProfitMarginAnnual?(100*r.netProfitMarginAnnual).toFixed(2)+'%':'N/A',targetPrice:q.targetMean||q.targetMedian||'N/A',ebitdaGrowth:r.revenueGrowthTTMYoy?(100*r.revenueGrowthTTMYoy).toFixed(2)+'%':r.revenueGrowthQuarterlyYoy?(100*r.revenueGrowthQuarterlyYoy).toFixed(2)+'%':'N/A',analystRating:s?formatAnalystRating(s):'N/A',analystCount:s?s.buy+s.hold+s.sell+s.strongBuy+s.strongSell+' analystes':'N/A'}}catch(a){return console.error('Erreur fondamentaux:',a),{name:'N/A',peRatio:'N/A',eps:'N/A',profitMargin:'N/A',targetPrice:'N/A',ebitdaGrowth:'N/A',analystRating:'N/A',analystCount:'N/A'}}}function formatAnalystRating(a){const b=a.buy+a.hold+a.sell+a.strongBuy+a.strongSell;if(0===b)return'N/A';const c=(5*a.strongBuy+4*a.buy+3*a.hold+2*a.sell+a.strongSell)/b;return 4<=c?'\uD83D\uDFE2 STRONG BUY':3.5<=c?'\uD83D\uDFE2 BUY':2.5<=c?'\uD83D\uDFE1 HOLD':2<=c?'\uD83D\uDD34 SELL':'\uD83D\uDD34 STRONG SELL'}function calculateMA(a,b){return a.map(function(c,d){if(d<b-1)return null;for(var e=0,f=d-b+1;f<=d;f++)e+=a[f].price;return e/b})}function calculateRSI(a,b){return b=b||14,a.map(function(c,d){if(d<b)return 50;for(var e=0,f=0,g=d-b+1;g<=d;g++){var h=a[g].price-a[g-1].price;0<h?e+=h:f-=h}var i=e/b/((f/b)||.001);return 100-100/(1+i)})}function calculateVolatility(a,b){return b=b||30,a.map(function(c,d){if(d<b)return 0;for(var e=[],f=d-b+1;f<=d;f++)e.push((a[f].price-a[f-1].price)/a[f-1].price);var g=e.reduce(function(a,b){return a+b})/e.length,h=e.reduce(function(a,b){return a+Math.pow(b-g,2)},0)/e.length;return Math.sqrt(h)*Math.sqrt(252)})}function calculateRiskMetric(a){var b=calculateMA(a,50),c=calculateMA(a,200),d=calculateRSI(a),e=calculateVolatility(a);return a.map(function(a,f){var g=0;if(b[f]&&c[f]){var h=((a.price-b[f])/b[f]+(a.price-c[f])/c[f])/2;g=Math.min(.35,Math.max(0,2*h+.175))}var i=.35;d[f]&&(i=50<d[f]?.35*(d[f]-50)/50:.35*-1*(50-d[f])/50+.35);var j=Math.min(.3,1.5*e[f]),k=Math.max(0,Math.min(1,g+i+j));return{date:a.date,price:a.price,riskMetric:k,ma50:b[f],ma200:c[f]}})}function getRiskColor(a){return.3>a?'#22c55e':.5>a?'#eab308':.7>a?'#f97316':'#ef4444'}function getRiskLabel(a){return.3>a?'\uD83D\uDFE2 RISQUE FAIBLE':.5>a?'\uD83D\uDFE1 RISQUE MOD\u00c9R\u00c9':.7>a?'\uD83D\uDFE0 RISQUE \u00c9LEV\u00c9':'\uD83D\uDD34 RISQUE TR\u00c8S \u00c9LEV\u00c9'}function displayResults(a,b,c){var d=b[b.length-1],e=getRiskColor(d.riskMetric);document.getElementById('tickerDisplay').textContent=a,document.getElementById('priceDisplay').textContent='$'+d.price.toFixed(2),document.getElementById('companyName').textContent=c.name,document.getElementById('riskDisplay').textContent=d.riskMetric.toFixed(3),document.getElementById('riskDisplay').style.color=e,document.getElementById('riskBar').style.width=100*d.riskMetric+'%',document.getElementById('riskBar').style.background=e,document.getElementById('recommendation').textContent=getRiskLabel(d.riskMetric),document.getElementById('recommendation').style.color=e,document.getElementById('trendIcon').textContent=.5>d.riskMetric?'\uD83D\uDCC8':'\uD83D\uDCC9',document.getElementById('peRatio').textContent='N/A'!==c.peRatio?parseFloat(c.peRatio).toFixed(2):'N/A',document.getElementById('eps').textContent='N/A'!==c.eps?'$'+parseFloat(c.eps).toFixed(2):'N/A',document.getElementById('profitMargin').textContent=c.profitMargin;var f=parseFloat(c.targetPrice);if(isNaN(f))document.getElementById('targetPrice').textContent='N/A',document.getElementById('priceUpside').textContent='';else{document.getElementById('targetPrice').textContent='$'+f.toFixed(2);var g=((f-d.price)/d.price*100).toFixed(1),h=0<g?'#22c55e':'#ef4444';document.getElementById('priceUpside').innerHTML='<span style="color:'+h+';">'+(0<g?'+':'')+g+'% potentiel</span>'}document.getElementById('ebitdaGrowth').textContent=c.ebitdaGrowth,document.getElementById('analystRating').textContent=c.analystRating,document.getElementById('analystCount').textContent=c.analystCount,document.getElementById('results').classList.add('show'),createPriceChart(b),createRiskChart(b)}function createPriceChart(a){var b=document.getElementById('priceChart').getContext('2d');priceChart&&priceChart.destroy(),priceChart=new Chart(b,{type:'line',data:{labels:a.map(function(a){return a.date}),datasets:[{label:'Prix',data:a.map(function(a){return a.price}),borderColor:'#3b82f6',borderWidth:2,tension:.1,pointRadius:0},{label:'MA50',data:a.map(function(a){return a.ma50}),borderColor:'#22c55e',borderWidth:1.5,tension:.1,pointRadius:0},{label:'MA200',data:a.map(function(a){return a.ma200}),borderColor:'#f97316',borderWidth:1.5,tension:.1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,plugins:{legend:{labels:{color:'#cbd5e1'}}},scales:{x:{ticks:{color:'#94a3b8',maxTicksLimit:10},grid:{color:'#334155'}},y:{ticks:{color:'#94a3b8'},grid:{color:'#334155'}}}}})}function createRiskChart(a){var b=document.getElementById('riskChart').getContext('2d');riskChart&&riskChart.destroy(),riskChart=new Chart(b,{type:'line',data:{labels:a.map(function(a){return a.date}),datasets:[{label:'Risk Metric',data:a.map(function(a){return a.riskMetric}),borderColor:'#8b5cf6',backgroundColor:'rgba(139,92,246,0.3)',borderWidth:2,fill:!0,tension:.3,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:2.5,plugins:{legend:{labels:{color:'#cbd5e1'}}},scales:{x:{ticks:{color:'#94a3b8',maxTicksLimit:10},grid:{color:'#334155'}},y:{min:0,max:1,ticks:{color:'#94a3b8'},grid:{color:'#334155'}}}}})}function showError(a,b){var c=document.getElementById('errorMsg');c.textContent=a,c.className='error show','success'===b&&(c.style.background='#059669',setTimeout(function(){hideError()},3e3))}function hideError(){document.getElementById('errorMsg').classList.remove('show')}
    </script>
</body>
</html>
